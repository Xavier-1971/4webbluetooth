<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>ESP32 BLE Neopixel</title>
<style>
body {
    font-family: Arial;
    text-align: center;
    background: #f4f4f4;
}
button, input {
    font-size: 1.2em;
    margin: 10px;
}
</style>
</head>

<body>

<h1>Commande LED Neopixel (BLE)</h1>

<button onclick="connect()">ðŸ”— Connexion BLE</button><br>

<label>Couleur :</label><br>
<input type="color" id="colorPicker" value="#ff0000" onchange="sendColor()"><br>

<label>LuminositÃ© :</label><br>
<input type="range" id="brightness" min="0" max="100" value="50" onchange="sendBrightness()">

<script>
let device;
let server;
let colorChar;
let brightChar;

// UUIDs (identiques Ã  l'ESP32)
const SERVICE_UUID = '177e6db6-33e5-42fa-9e64-093ccd59eca6';
const COLOR_UUID   = '177e6db7-33e5-42fa-9e64-093ccd59eca6';
const BRIGHT_UUID  = '177e6db8-33e5-42fa-9e64-093ccd59eca6';

async function connect() {
    device = await navigator.bluetooth.requestDevice({
        filters: [{ services: [SERVICE_UUID] }]
    });

    server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID);

    colorChar  = await service.getCharacteristic(COLOR_UUID);
    brightChar = await service.getCharacteristic(BRIGHT_UUID);

    alert("ConnectÃ© Ã  l'ESP32 !");
}

function sendColor() {
    if (!colorChar) return;

    const hex = document.getElementById("colorPicker").value;
    const r = parseInt(hex.substr(1,2),16);
    const g = parseInt(hex.substr(3,2),16);
    const b = parseInt(hex.substr(5,2),16);

    const data = new Uint8Array([r, g, b]);
    colorChar.writeValue(data);
}

function sendBrightness() {
    if (!brightChar) return;

    const value = document.getElementById("brightness").value;
    brightChar.writeValue(new Uint8Array([value]));
}
</script>

</body>
</html>
